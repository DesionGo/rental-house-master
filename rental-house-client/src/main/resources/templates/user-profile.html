<!DOCTYPE html>
<html  xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <meta name="description" content="Webartinfo">
      <meta name="author" content="Webartinfo">
      <title>Manland - Bootstrap Light Real Estate HTML Template</title>


   </head>
   <body>
      <!-- Navbar -->
      <header>
         <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container">
               <a class="navbar-brand text-success logo" href="index.html">
                  <img class="img-fluid" src="/static/img/agency-list/logo.png" style="width: 200px;height: auto">
               </a>
               <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
               <span class="navbar-toggler-icon"></span>
               </button>
               <div class="collapse navbar-collapse" id="navbarResponsive">
                  <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
                     <li class="nav-item">
                        <a class="nav-link" th:href="@{/}">
                           主页
                        </a>
                     </li>
                     <li class="nav-item dropdown">
                        <a class="nav-link" th:href="@{'/propertiesGrid?current=1'}">
                           出租广场
                        </a>
                     </li>

                     <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownPortfolio" data-toggle="dropdown"
                           aria-haspopup="true" aria-expanded="false">
                           我的账户
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdownPortfolio">
                           <a class="dropdown-item" th:href="@{/userProfile}">用户资料</a>

                           <a class="dropdown-item" th:href="@{'/myProperties?current=1'}">我的财产</a>
                           <a class="dropdown-item" th:href="@{'/favoriteProperties?current=1'}">收藏列表</a>
                           <a class="dropdown-item" th:href="@{/addProperty}">新增出租</a>
                        </div>
                     </li>
                     <!-- <li class="nav-item dropdown">
                       <a class="nav-link" href="about.html">
                          关于我们
                       </a>

                    </li>-->
                  </ul>
                  <div class="my-2 my-lg-0">
                     <ul th:if="${clientUser.userName} eq null" class="list-inline main-nav-right">
                        <li class="list-inline-item">
                           <a class="btn btn-link btn-sm" th:href="@{/login}">登陆</a>
                        </li>
                        <li class="list-inline-item">
                           <a class="btn btn-success btn-sm" th:href="@{/register}">注册</a>
                        </li>
                     </ul>
                     <ul th:if="${clientUser.userName} ne null"  class="list-inline main-nav-right">
                        <li class="list-inline-item">
                           <a class="btn btn-link btn-sm" th:href="@{/login}">欢迎您,[[${clientUser.userName}]]</a>
                        </li>
                        <li class="list-inline-item">
                           <a class="btn btn-success btn-sm" th:href="@{/logout}">退出</a>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </nav>
      </header>
      <!-- End Navbar -->
      <!-- Inner Header -->
      <section class="bg-dark py-5 user-header">
         <div class="container">
            <div class="row align-items-center mt-2 mb-5 pb-4">
               <div class="col">
                  <!-- Heading -->
                  <h1 class="text-white mb-2">
                     用户信息
                  </h1>
                  <!-- Text -->
                  <h6 class="font-weight-normal text-white-50 mb-0">
                     Settings for <a class="text-reset" href="mailto:yoursite@gmail.com">yoursite@gmail.com</a>
                  </h6>
               </div>

            </div>
            <!-- / .row -->
         </div>
         <!-- / .container -->
      </section>
      <!-- End Inner Header -->
      <!-- User Profile -->
      <section class="section-padding pt-0 user-pages-main">
         <div class="container">
            <div class="row">
               <div class="col-lg-3 col-md-3">
                  <!-- Collapse -->
                  <div class="card padding-card tab-view user-pages-sidebar">
                     <div class="card-body">
                        <!-- Heading -->
                        <h6 class="text-uppercase mt-0 mb-3">
                           账户
                        </h6>
                        <ul class="nav">
                           <li class="nav-item">
                              <a  class="nav-link active text-success"  th:href="@{/userProfile}">用户资料</a>
                           </li>

                           <li class="nav-item">
                              <a class="nav-link" th:href="@{/myProperties}">我的财产</a>
                           </li>
                           <li class="nav-item">
                              <a class="nav-link" th:href="@{/favoriteProperties}">收藏列表</a>
                           </li>
                           <li class="nav-item">
                              <a  class="nav-link"  th:href="@{/addProperty}">新增出租</a>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
               <div class="col-lg-9 col-md-9">
                  <form  id="userForm" name="form1">
                     <div class="card padding-card">
                        <div class="card-body">
                           <h5 class="card-title mb-4">个人资料</h5>
                           <div class="form-group">
                              <label>用户名：<span class="text-danger">*</span></label>
                              <input type="text" th:if="${clientUser.userName} eq ''" id="un" class="form-control"   name="userName" placeholder="请输入用户名">
                              <input type="text" th:if="${clientUser.userName} ne ''" class="form-control" id="un"   name="userName" th:placeholder="${clientUser.userName}">
                           </div>
                           <div class="form-group">
                              <label>手机号：<span class="text-danger">*</span></label>
                              <input type="text" th:if="${clientUser.phone} eq ''" class="form-control" id="tel"  name="phone" placeholder="请输入电话号码">
                              <input type="text" th:if="${clientUser.phone} ne ''" class="form-control" id="tel"   name="phone" th:placeholder="${clientUser.phone}">
                           </div>
                           <div class="form-group">
                              <label>邮箱 <span class="text-danger">*</span></label>
                              <input type="email" th:if="${clientUser.email} eq ''" class="form-control" id="em"  name="email" placeholder="请输入邮箱">
                              <input type="email" th:if="${clientUser.email} ne ''" class="form-control" id="em"  name="email" th:placeholder="${clientUser.email}">
                           </div>
                           <div class="form-group">
                              <label>性别 <span class="text-danger">*</span></label>
                              <select  class="form-control select2" id="sex" name="sex" >
                                 <option value="1">男</option>
                                 <option value="2">女</option>
                              </select>
                           </div>
                           <div class="form-group">
                              <label>省： <span class="text-danger">*</span></label>

                              <select  class="form-control select2" id ="provinceList" name="province"  onchange="cityForm(this.value)">



                              </select>

                           </div>
                           <div class="form-group">
                              <label>市： <span class="text-danger">*</span></label>

                              <select class="form-control select2" id ="cityList" name="city"  onchange="countiesForm(this.value)">

                              </select>

                           </div>
                           <div class="form-group">
                              <label>区/县： <span class="text-danger">*</span></label>

                              <select  class="form-control select2"  id="countiesList" name="counties">

                              </select>

                           </div>
                         <!--  <div class="form-group">
                              <label>关于我： <span class="text-danger">*</span></label>
                              <textarea rows="10" cols="100" class="form-control"></textarea>
                           </div> -->
                        </div>
                     </div>
                     <div class="card padding-card">
                        <div class="card-body">
                           <h5 class="card-title mb-4">更改密码</h5>
                           <div class="form-group">
                              <label>旧密码：<span class="text-danger">*</span></label>
                              <input type="password" class="form-control" id="oldPassword" name="oldPassword" placeholder="">
                           </div>
                           <div class="form-group">
                              <label>新密码：<span class="text-danger">*</span></label>
                              <input type="password" class="form-control" id="newPassword" name="newPassword" placeholder="">
                           </div>
                           <div class="form-group">
                              <label>确认密码：<span class="text-danger">*</span></label>
                              <input type="password" class="form-control" id="password" name="password" placeholder="">
                           </div>
                        </div>
                     </div>
                     <button type="button" class="btn btn-success" onclick="sunbimt()">保存编辑</button>
                  </form>

               </div>
            </div>
         </div>
      </section>
      <!--   <section class="py-5 bg-primary">
         <div class="container">
            <div class="row align-items-center text-center text-md-left">
               <div class="col-md-8">
                  <h2 class="text-white my-2">您受否有问题？咨询下客服吧！  -》</h2>
               </div>
               <div class="col-md-4 text-center text-md-right">
               <button type="button"
                     class="btn btn-light my-2">联系客服</button>
               </div>
            </div>
         </div>
      </section>-->

      <section class="pt-4 pb-4">
         <div class="container">
            <div class="row align-items-center text-center text-md-left">
               <div class="col-md-6">
                  <p class="mt-0 mb-0">© 版权所有 2021 出租房工作室. 版权所有</p>
               </div>
               <div class="col-md-6 text-center text-md-right">
                  <p class="mt-0 mb-0">
                     Made with <i class="mdi mdi-heart text-danger"></i> by
                     <a class="text-dark font-weight-bold" target="_blank" href="http://www.bootstrapmb.com">Webartinfo</a>
                  </p>
               </div>
            </div>
         </div>
      </section>
      <script th:replace="common/base::context"></script>
      <script th:replace="common/base::iconpkcss"></script>
      <script th:replace="common/base::mainjs"></script>
   <script>
      function sunbimt() {
         if( document.getElementById('provinceList').value==null||document.getElementById('provinceList').value==''){
            alert("省不能空")
            return false;
         }else{
            if(document.getElementById('cityList').value==null||document.getElementById('cityList').value==''){
               alert("市区不能空")

               return false;
            }
            if(document.getElementById('oldPassword').value==null||document.getElementById('oldPassword').value==''){
               console.log("过")

            }else{
               if(document.getElementById('newPassword').value==null||document.getElementById('newPassword').value==''){
                  alert("请输入新密码！")
                  return false;
               }else{
                  if(document.getElementById('newPassword').value!=document.getElementById('password').value){
                     alert("请确认好密码！")
                     return false
                  }
               }
            }

         }

         $.ajax({
            //几个参数需要注意一下
            type: "POST",//方法类型
            dataType: "json",//预期服务器返回的数据类型
            contentType: "application/json   ",
            url: "/editUserProfile" ,//url

            data: JSON.stringify({userName:form1.userName.value,phone:form1.phone.value,email:form1.email.value,sex:form1.sex.value,city:form1.city.value,province:form1.province.value,county:form1.counties.value}),
            success: function (result) {
               console.log(result);//打印服务端返回的数据(调试用)
               if (result.code == 200) {
                  alert("SUCCESS");
                  $.ajax({
                     url: 'sys/user/changePwd',
                     type: 'POST',
                     data: {oldPassword:form1.oldPassword.value,password:form1.password.value},

                     success: function(data) {
                        if (data.code == 200) {
                           alert("修改成功");
                        }
                     },
                     error: function(err) {
                        alert("修改失败");
                     }
                  });
               }else{
                  alert("异常！");
               }
               ;
            },
            error : function() {
               alert("异常！");
            }
         });

      }
      function cityForm(data){
         console.log(data);
         var city=data;
         kvfKit.aGet(BASE_WEB + 'sys/city?city='+city, function (r) {
            var data=r.data;
            $("#cityList").find("option").remove();
            $("#countiesList").find("option").remove();
            var opt;
            opt=new Option("","");
            document.getElementById('cityList').options.add(opt);
            for (var i = 0; i <= data.length; i++) {
               opt = new Option(data[i], data[i]);
               document.getElementById('cityList').options.add(opt);
            }
         });
      }
      function countiesForm(data){
         console.log(data);
         var city= document.getElementById('provinceList').value;
         var counties=data;
         kvfKit.aGet(BASE_WEB + 'sys/counties?city='+city+"&&counties="+counties, function (r) {
            var data=r.data;
            if(JSON.stringify(data) == "[]"){
               $("#counties").css("display", "none");
            }else{
               $("#counties").css("display", "inline");
            }
            $("#countiesList").find("option").remove();
            for (var i = 0; i <= data.length; i++) {
               var opt = new Option(data[i], data[i]);
               document.getElementById('countiesList').options.add(opt);
            }
         });
      }

      //JavaScript代码区域
      layui.use(['element', 'layer', 'laytpl','form'], function(){
         var element = layui.element, laytpl = layui.laytpl, layer = layui.layer,form = layui.form;

         $('#sex').val('[[${clientUser.sex}]]')
         kvfKit.aGet(api.province, function (r) {

            laytpl($('#provinceList').html()).render(r.data, function (html) {
               console.log(r.data)
               var data=r.data;
               var option = '';

               for(var i=0;i<data.length;i++){
                  //循环获取返回值，并组装成html代码
                  option +="<option value='"+data[i]+"'>"+data[i]+"</option>";
               }
               $("#provinceList").html("");
               $("#provinceList").append(option);
            });
            document.getElementsByName("province")[0].value='[[${clientUser.province}]]';
         });



      });
      layui.use(['element', 'layer', 'laytpl','form'], function() {
         var element = layui.element, laytpl = layui.laytpl, layer = layui.layer, form = layui.form;
         kvfKit.aGet(BASE_WEB + 'sys/city?city=' + '[[${clientUser.province}]]', function (r) {
            var data = r.data;
            $("#cityList").find("option").remove();
            $("#countiesList").find("option").remove();
            var opt;
            opt = new Option("", "");
            document.getElementById('cityList').options.add(opt);
            for (var i = 0; i <= data.length; i++) {
               opt = new Option(data[i], data[i]);
               document.getElementById('cityList').options.add(opt);
               if(data[i]=='[[${clientUser.city}]]'){
                  opt.selected = true;
               }
            }
         });

      });
      layui.use(['element', 'layer', 'laytpl','form'], function() {
         var element = layui.element, laytpl = layui.laytpl, layer = layui.layer, form = layui.form;


         kvfKit.aGet(BASE_WEB + 'sys/counties?city=' + '[[${clientUser.province}]]' + "&&counties=" + '[[${clientUser.city}]]', function (r) {
            var data = r.data;
            if (JSON.stringify(data) == "[]") {
               $("#counties").css("display", "none");
            } else {
               $("#counties").css("display", "inline");
            }
            $("#countiesList").find("option").remove();
            for (var i = 0; i <= data.length; i++) {
               var opt = new Option(data[i], data[i]);
               document.getElementById('countiesList').options.add(opt);
               if(data[i]=='[[${clientUser.county}]]'){
                  opt.selected = true;
               }
            }
         });
      })
   </script>
   </body>
</html>